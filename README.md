# Проект: Генератор отчетов по ПЭ

## Описание

Проект представляет собой усовершенствованную версию программы для автоматического формирования отчетов на основе Excel-выгрузок. Основные функциональные возможности:

- Парсинг входных данных из Excel-файлов
- Генерация структурированных отчетов
- Форматирование выходных документов

## Ключевые улучшения новой версии

По сравнению с предыдущей реализацией, текущая версия обладает рядом преимуществ:

1. **Четкая модульная архитектура** - логика разделена между независимыми компонентами
2. **Комплексное тестирование** - реализован набор автотестов для критически важного функционала
3. **Автоматизированная сборка** - встроен CI/CD-пайплайн через скрипт build.bat
4. **Гибкая конфигурация** - настройки вынесены в переменные окружения

Проект разработан с учетом требований к масштабируемости и удобству внесения изменений в будущем.

## Структура проекта

```
.
├── app/                          # Основной пакет приложения
│   ├── __init__.py               # Фабрика Flask-приложения, data cleaner и класс для префиксов
│   ├── static/                   # Статические файлы (CSS, JS, изображения)
│   ├── templates/                # HTML шаблоны
│   ├── routes.py                 # Эндпоинты приложения
│   ├── controller.py             # Бизнес-логика обработки запросов
│   ├── schemas.py                # Схемы данных
│   ├── utils.py                  # Утилиты для работы с файлами и Excel
│   ├── drawer.py                 # Классы для генерации отчетов
|   └── report_config.json        # Конфишурация отчета по ПЭ, используется как шаблон для генерации
├── htmlcov/                      # Отчет о покрытии кода тестами
├── tests/                        # Тесты приложения
├── uploads/                      # Папка для загружаемых файлов (используется в работе)
├── venv/                         # Виртуальное окружение Python
├── app.py                        # Точка входа для запуска в режиме отладки
├── pytest.ini                    # Конфигурация pytest
├── requirements.txt              # Зависимости Python
├── Dockerfile                    # Конфигурация Docker образа
├── gunicorn.conf.py              # Конфигурация Gunicorn для запуска очистки uploads в фоновом потоке
├── .dockerignore                 # Игнорируемые файлы для Docker
├── .gitignore                    # Игнорируемые файлы для Git
├── build.bat                     # CI/CD скрипт (тесты, покрытие, сборка Docker)
└── README.md                     # Этот файл
```

## Установка и запуск

### Локальная разработка

1. Создайте виртуальное окружение:
   ```bash
   python -m venv venv
   ```

2. Активируйте окружение:
   - Windows: `venv\Scripts\activate`
   - Unix/macOS: `source venv/bin/activate`

3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

4. Запустите приложение:
   ```bash
   python app.py
   ```

### Запуск через Docker

1. Соберите образ:
   ```bash
   docker build -t flask-report .
   ```

2. Запустите контейнер:
   ```bash
   docker run -p 5000:5000 flask-report
   ```

Или используйте `build.bat` для автоматизированного процесса тестирования и сборки.

Для полной работы CI/CD в скрипт необходимо добавить подключение к серверу по ssh и загрузку туда новых версий docker образов.

На данный момент скрипт полностью справляется с **локальной** сборкой и тестированием 

## Тестирование

Для запуска тестов:
```bash
pytest
```

Для проверки покрытия:
```bash
pytest --cov=app tests/ --cov-report=html
```

Отчет о покрытии будет сгенерирован в папке `htmlcov/`.

## Конфигурация

Основные настройки приложения можно задать через переменные окружения:
- `SCRIPT_NAME` - префикс для URL (из `__init__.py`)
- Другие важные переменные...

## Особенности реализации

- **Data Cleaner**: Работает в фоновом потоке, периодически очищает папку `uploads`
- **Генерация отчетов**: Реализована в модуле `drawer.py`
- **Работа с Excel**: Утилиты в `utils.py`

## Дальнейшее развитие

Для далнейшего развития проекта необходимо:
 - **Рефакторинг drawer.py**: в работу самого генератора отчетов можно внести улучшения, сделав его оптимизированнее, а также отделить логику создания отчета от его параметров
 - **Разделение логики**: нужно вынести больше параметров отчета в файл конфигурации, сейчас там есть названия и порядок колонок

## Лицензия

Работает в рамках АО "Петербургский Тракторный Завод"